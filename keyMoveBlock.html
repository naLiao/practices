<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        #box{
            width: 200px;
            height: 200px;
            background: hotpink;
            position: absolute;
        }
    </style>
</head>
<body>
    <div id="box"></div>
    <script>
        const box = document.getElementById('box');
        //第二种运动方式：可以同时向多个方向运动，用动画帧让运动性能更高，需要注意动画帧开启和关闭的位置
        let timer = null;
        let onOff = true;
        var obj = {
            left:false,
            top:false,
            right:false,
            down:false
        }

        window.onkeydown = function (ev) {
            if(onOff){  //onOff开关打开时才可以开启动画帧
                timer = requestAnimationFrame(function(){
                    moveByKey();
                })
            }
            onOff = false;
            if(ev.keyCode === 37){  //向左
                obj.left = true;
            }
            if(ev.keyCode === 38){  //向上
                obj.top = true;
            }
            if(ev.keyCode === 39){  //向右
                obj.right = true;
            }
            if(ev.keyCode === 40){  //向下
                obj.down = true;
            }
        }

        window.onkeyup = function (ev) {
            if(ev.keyCode === 37){  //向左
                obj.left = false;
            }
            if(ev.keyCode === 38){  //向上
                obj.top = false;
            }
            if(ev.keyCode === 39){  //向右
                obj.right = false;
            }
            if(ev.keyCode === 40){  //向下
                obj.down = false;
            }

            //如果四个键都抬起，清除动画帧
            if(!obj.left && !obj.top && !obj.right && !obj.down){
                console.log('清除');
                cancelAnimationFrame(timer);
                onOff = true;  //清除当前动画帧后打开onOff开关
            }
        }

        function moveByKey() {
            if(obj.left){
                box.style.left = (box.offsetLeft -5) + 'px';
            }
            if(obj.top){
                box.style.top = (box.offsetTop -5) + 'px';
            }
            if(obj.right){
                box.style.left = (box.offsetLeft +5) + 'px';
            }
            if(obj.down){
                box.style.top = (box.offsetTop +5) + 'px';
            }
            if(obj.left || obj.top || obj.right || obj.down){
                requestAnimationFrame(moveByKey);
            }
            // console.log(123);
        }

        //第一种运动模式：每次只能一个方向，修复了换方向时停顿问题
        // let oldTime = +new Date;
        // window.onkeydown = function (ev) {
        //     // let newTime = +new Date;
        //     // console.log(newTime - oldTime);  //检测时间发现会停顿约500ms，不同浏览器可能不同
        //     // oldTime = newTime;
        //     clearInterval(timer);  //必须先清除定时器，都在down事件一直在触发，会开很多个定时器
        //     timer = setInterval(function () {
        //         if(ev.keyCode === 37){  //向左
        //             box.style.left = (box.offsetLeft -5) + 'px';
        //         }
        //         if(ev.keyCode === 38){  //向上
        //             box.style.top = (box.offsetTop -5) + 'px';
        //         }
        //         if(ev.keyCode === 39){  //向右
        //             box.style.left = (box.offsetLeft +5) + 'px';
        //         }
        //         if(ev.keyCode === 40){  //向下
        //             box.style.top = (box.offsetTop +5) + 'px';
        //         }
        //     },24)
        // }
        //
        // window.onkeyup = function (ev) {
        //     clearInterval(timer);
        // }
    </script>
</body>
</html>